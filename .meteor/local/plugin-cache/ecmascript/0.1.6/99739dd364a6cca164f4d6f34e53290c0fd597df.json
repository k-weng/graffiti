{"metadata":{"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}},"usedHelpers":[]},"ignored":false,"code":"Meteor.publish('groups', function () {\n\treturn Groups.find();\n});\n\nMeteor.publish('messages', function (group) {\n\tconsole.log(\"publications **** \" + group);\n\tvar weight = -15 * 60 * 1000;\n\tvar maxLife = 2 * 5 * 1000;\n\t// Messages.aggregate(\n\t// [{$project:\n\t// \t{\n\t// \t\tlife:{$add: [\"$life\", [{ $multiply: [\"$votes\", (-15)*(60)*(1000)]} ] ]}\n\t// \t}\n\t// }\n\t// ]);\n\tMessages.find().forEach(function (data) {\n\t\tconsole.log(maxLife - (Date.now() - data.timestamp));\n\t\tvar now = Date.now();\n\t\tMessages.update({ _id: data._id }, { $set: { life: maxLife - (now - data.timestamp) + weight * data.votes }\n\t\t});\n\t});\n\n\tMessages.remove({ life: { $lt: 0 } });\n\n\treturn Messages.find({ groupId: group }, { life: { $gt: 0 } });\n});\n\n//Meteor.publish(\"allUsers\", function () {\n//  return Meteor.users.find({});\n//});","ast":null,"map":{"version":3,"sources":["/server/publications.js"],"names":[],"mappings":"AAAA,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAC,YAAU;AACjC,QAAO,MAAM,CAAC,IAAI,EAAE,CAAC;CACrB,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,UAAU,EAAC,UAAS,KAAK,EAAC;AACxC,QAAO,CAAC,GAAG,CAAC,oBAAoB,GAAG,KAAK,CAAC,CAAC;AAC1C,KAAI,MAAM,GAAG,AAAC,CAAC,EAAE,GAAG,EAAE,AAAC,GAAE,IAAI,AAAC,CAAC;AAC/B,KAAI,OAAO,GAAG,AAAC,CAAC,GAAG,CAAC,AAAC,GAAE,IAAI,AAAC,CAAC;;;;;;;;AAQ7B,SAAQ,CAAC,IAAI,EAAE,CAAC,OAAO,CAAC,UAAS,IAAI,EAAC;AACrC,SAAO,CAAC,GAAG,CAAC,OAAO,IAAI,IAAI,CAAC,GAAG,EAAE,GAAC,IAAI,CAAC,SAAS,CAAA,AAAC,CAAC,CAAC;AACnD,MAAI,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AACrB,UAAQ,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,IAAI,CAAC,GAAG,EAAC,EAC7B,EAAC,IAAI,EAAC,EAAC,IAAI,EAAE,OAAO,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAA,AAAC,GAAG,MAAM,GAAC,IAAI,CAAC,KAAK,EAAE;GACnE,CAAC,CAAC;EACH,CAAC,CAAC;;AAEH,SAAQ,CAAC,MAAM,CAAC,EAAC,IAAI,EAAC,EAAC,GAAG,EAAC,CAAC,EAAC,EAAC,CAAC,CAAC;;AAEhC,QAAO,QAAQ,CAAC,IAAI,CAAC,EAAC,OAAO,EAAC,KAAK,EAAC,EAAC,EAAC,IAAI,EAAC,EAAC,GAAG,EAAC,CAAC,EAAC,EAAC,CAAC,CAAC;CACrD,CAAC,CAAC","file":"/server/publications.js.map","sourcesContent":["Meteor.publish('groups',function(){\n\treturn Groups.find();\n});\n\nMeteor.publish('messages',function(group){\n\tconsole.log(\"publications **** \" + group);\n\tvar weight = (-15)*(60)*(1000);\n\tvar maxLife = (2)*(5)*(1000);\n\t// Messages.aggregate(\n\t// [{$project:\n\t// \t{\n\t// \t\tlife:{$add: [\"$life\", [{ $multiply: [\"$votes\", (-15)*(60)*(1000)]} ] ]}\n\t// \t}\n\t// }\n\t// ]);\n\tMessages.find().forEach(function(data){\n\t\tconsole.log(maxLife - (Date.now()-data.timestamp));\n\t\tvar now = Date.now();\n\t\tMessages.update({_id:data._id},\n\t\t\t{$set:{life: maxLife - (now - data.timestamp) + weight*data.votes }\n\t\t});\n\t});\n\n\tMessages.remove({life:{$lt:0}});\n\n\treturn Messages.find({groupId:group},{life:{$gt:0}});\n});\n\n//Meteor.publish(\"allUsers\", function () {\n//  return Meteor.users.find({});\n//});\n"]},"hash":"99739dd364a6cca164f4d6f34e53290c0fd597df"}
