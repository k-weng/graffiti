{"metadata":{"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}},"usedHelpers":[]},"ignored":false,"code":"Meteor.publish('groups', function () {\n\treturn Groups.find();\n});\n\nMeteor.publish('messages', function (group) {\n\tconsole.log(\"publications **** \" + group);\n\tvar weight = -15 * 60 * 1000;\n\tvar maxLife = 15 * 60 * 1000;\n\t// Messages.aggregate(\n\t// [{$project:\n\t// \t{\n\t// \t\tlife:{$add: [\"$life\", [{ $multiply: [\"$votes\", (-15)*(60)*(1000)]} ] ]}\n\t// \t}\n\t// }\n\t// ]);\n\tMessages.find().forEach(function (data) {\n\t\t// console.log(maxLife - (Date.now()-data.timestamp));\n\t\tMessages.update({ _id: data._id }, { $set: { life: maxLife - (Date.now() - data.timestamp) + weight * data.votes }\n\t\t});\n\t});\n\treturn Messages.find({ groupId: group });\n});\n\n//Meteor.publish(\"allUsers\", function () {\n//  return Meteor.users.find({});\n//});","ast":null,"map":{"version":3,"sources":["/server/publications.js"],"names":[],"mappings":"AAAA,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAC,YAAU;AACjC,QAAO,MAAM,CAAC,IAAI,EAAE,CAAC;CACrB,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,UAAU,EAAC,UAAS,KAAK,EAAC;AACxC,QAAO,CAAC,GAAG,CAAC,oBAAoB,GAAG,KAAK,CAAC,CAAC;AAC1C,KAAI,MAAM,GAAG,AAAC,CAAC,EAAE,GAAG,EAAE,AAAC,GAAE,IAAI,AAAC,CAAC;AAC/B,KAAI,OAAO,GAAG,AAAC,EAAE,GAAG,EAAE,AAAC,GAAE,IAAI,AAAC,CAAC;;;;;;;;AAQ/B,SAAQ,CAAC,IAAI,EAAE,CAAC,OAAO,CAAC,UAAS,IAAI,EAAC;;AAErC,UAAQ,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,IAAI,CAAC,GAAG,EAAC,EAC7B,EAAC,IAAI,EAAC,EAAC,IAAI,EAAE,OAAO,IAAI,IAAI,CAAC,GAAG,EAAE,GAAC,IAAI,CAAC,SAAS,CAAA,AAAC,GAAG,MAAM,GAAC,IAAI,CAAC,KAAK,EAAE;GACxE,CAAC,CAAC;EACH,CAAC,CAAC;AACH,QAAO,QAAQ,CAAC,IAAI,CAAC,EAAC,OAAO,EAAC,KAAK,EAAC,CAAC,CAAC;CACtC,CAAC,CAAC","file":"/server/publications.js.map","sourcesContent":["Meteor.publish('groups',function(){\n\treturn Groups.find();\n});\n\nMeteor.publish('messages',function(group){\n\tconsole.log(\"publications **** \" + group);\n\tvar weight = (-15)*(60)*(1000);\n\tvar maxLife = (15)*(60)*(1000);\n\t// Messages.aggregate(\n\t// [{$project:\n\t// \t{\n\t// \t\tlife:{$add: [\"$life\", [{ $multiply: [\"$votes\", (-15)*(60)*(1000)]} ] ]}\n\t// \t}\n\t// }\n\t// ]);\n\tMessages.find().forEach(function(data){\n\t\t// console.log(maxLife - (Date.now()-data.timestamp));\n\t\tMessages.update({_id:data._id},\n\t\t\t{$set:{life: maxLife - (Date.now()-data.timestamp) + weight*data.votes }\n\t\t});\n\t});\n\treturn Messages.find({groupId:group});\n});\n\n//Meteor.publish(\"allUsers\", function () {\n//  return Meteor.users.find({});\n//});\n"]},"hash":"3795f288bbdd9721bea8d0557469b3cfdc8f1950"}
